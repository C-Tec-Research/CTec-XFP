<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
        xmlns:s="clr-namespace:System;assembly=mscorlib"
        xmlns:ctc="clr-namespace:CTecControls.UI;assembly=CTecControls"
        xmlns:ctuvh="clr-namespace:CTecUtil.UI.ViewHelpers;assembly=CTecUtil"
        xmlns:ctcvh="clr-namespace:CTecControls.UI.ViewHelpers;assembly=CTecControls"
        xmlns:Content="clr-namespace:Xfp.UI.Views" 
        xmlns:vh="clr-namespace:Xfp.UI.ViewHelpers"
        xmlns:viewmodels="clr-namespace:Xfp.ViewModels"
        d:DataContext="{d:DesignInstance Type=viewmodels:MainWindowViewModel}"
        x:Class="Xfp.Views.MainWindow"
        mc:Ignorable="d" 
        x:Name="wndMain"
        Title="{Binding Product_Full_Name, Source={StaticResource Resources}}"
        ResizeMode="CanResize"
        WindowStyle="None"
        Height="600" Width="1100"
        MinHeight="450" MinWidth="570"
        Loaded="window_Loaded"
        SizeChanged="window_SizeChanged"
        StateChanged="window_StateChanged"
        LocationChanged="window_LocationChanged"
        PreviewMouseWheel="window_PreviewMouseWheel" 
        PreviewMouseDown="window_PreviewMouseDown"
        PreviewKeyDown="window_PreviewKeyDown" 
        Deactivated="app_Deactivated"
        Closing="window_Closing">

    <shell:WindowChrome.WindowChrome>
        <shell:WindowChrome CaptionHeight="20"
                            CornerRadius="0"
                            GlassFrameThickness="0"
                            NonClientFrameEdges="Bottom"
                            ResizeBorderThickness="{x:Static SystemParameters.WindowResizeBorderThickness}"/>
    </shell:WindowChrome.WindowChrome>

    <Window.Effect>
        <!-- not needed for (or overridden by) Windows 11? -->
        <DropShadowEffect Color="Black"
                          Opacity="0.7"
                          Direction="70"
                          BlurRadius="40"
                          ShadowDepth="3"/>
    </Window.Effect>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <ctcvh:BoolToVisibilityHiddenConverter x:Key="BoolToVisibilityHiddenConverter"/>
        <ctcvh:BoolToYesNoConverter x:Key="BoolToYesNoConverter"/>
        <ctcvh:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
        <ctcvh:InverseBoolToVisibilityHiddenConverter x:Key="InverseBoolToVisibilityHiddenConverter"/>
        <ctcvh:BoolToInverseConverter x:Key="BoolToInverseConverter"/>
        <ctuvh:HandshakeConverter x:Key="HandshakeConverter"/>
        <ctuvh:ParityConverter x:Key="ParityConverter"/>
        <ctuvh:StopBitsConverter x:Key="StopBitsConverter"/>
        <ctcvh:IsNot1Converter x:Key="IsNot1Converter"/>
        <ctuvh:ConnectionStatusToBrushConverter x:Key="ConnectionStatusToBrushConverter"/>
        <ctuvh:ConnectionStatusToStringConverter x:Key="ConnectionStatusToStringConverter"/>
        <ctuvh:PrintQueueStatusToStringConverter x:Key="PrintQueueStatusToStringConverter"/>
        <ctcvh:TrimmedStringConverter x:Key="TrimmedStringConverter"/>
        <ctcvh:NonNullToVisibilityConverter x:Key="NonNullToVisibilityConverter"/>
        <ctcvh:BoolToOpacity80pcConverter x:Key="BoolToOpacity80pcConverter"/>
        <ctcvh:BoolToOpacity40pcConverter x:Key="BoolToOpacity40pcConverter"/>
        <ctcvh:InverseBoolToOpacity40pcConverter x:Key="InverseBoolToOpacity40pcConverter"/>
        <ctcvh:InverseBoolToOpacity20pcConverter x:Key="InverseBoolToOpacity20pcConverter"/>
        <ctcvh:IsNullToNAConverter x:Key="IsNullToNAConverter"/>
        <ctcvh:LanguageIconConverter x:Key="LanguageIconConverter"/>
        <ctcvh:LanguageFlagConverter x:Key="LanguageFlagConverter"/>
        <ctcvh:IsTrueToSVGPathDataConverter x:Key="IsTrueToSVGPathDataConverter"/>

        <Style x:Key="ContextMenuItemStyle" TargetType="Grid">
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource BrushOkHi}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!--<Style x:Key="PanelManagementGridHeader" TargetType="DataGridColumnHeader" BasedOn="{StaticResource PopupGridHeader}">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Height" Value="30"/>
        </Style>-->

    </Window.Resources>


    <Grid x:Name="mainPanel"
          LayoutTransform="{Binding LayoutTransform}" 
          Background="{StaticResource Brush10}"
          Margin="0,0,0,1.5">

        <Border BorderBrush="{StaticResource Brush03}" BorderThickness="0,0,1,1" >
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>


                <!--#region left bar -->
                
                <Grid Grid.Row="0" Grid.Column="0" Grid.RowSpan="3" Grid.ColumnSpan="1" Style="{StaticResource LeftBar}" MouseLeftButtonDown="mouseLeftButtonDown_DragMove" PreviewMouseDown="LeftBar_PreviewMouseDown">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="12"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition/>
                        </Grid.RowDefinitions>

                        <!--#region app info-->
                        <StackPanel Grid.Row="1" Orientation="Vertical" Margin="10,0,10,20" HorizontalAlignment="Center" MouseLeftButtonDown="mouseLeftButtonDown_DragMove">

                            <Grid HorizontalAlignment="Center">
                                <TextBlock Text="{Binding Program_Name, Source={StaticResource Resources}}" 
                                           Foreground="{StaticResource Brush09}" 
                                           HorizontalAlignment="Center" FontFamily="Verdana" FontSize="56" FontWeight="Bold" Padding="0" Margin="20,0,20,0"/>
                            </Grid>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock Text="{Binding Programming_Tools, Source={StaticResource Resources}}" 
                                           Foreground="{StaticResource Brush09}" 
                                           HorizontalAlignment="Center" FontSize="14" Padding="0" Margin="0,-8,0,0"/>
                            </StackPanel>
                            <Border Background="{StaticResource Brush01}" BorderThickness="0" CornerRadius="6" HorizontalAlignment="Center" Margin="0,5,0,0">
                                <TextBlock Text="{Binding VersionString}" 
                                           Foreground="{StaticResource  Brush09}" 
                                           HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="9" Margin="12,0,12,1.5"/>
                            </Border>
                        </StackPanel>
                        <!--#endregion-->

                        <!--#region navigation menu-->
                        <Grid Grid.Row="2">

                            <ListView ItemsSource="{Binding NavBarItems}"
                                      SelectedIndex="{Binding NavBarSelectedIndex}" 
                                      PreviewKeyDown="navBar_PreviewKeyDown"
                                      Foreground="{StaticResource Brush10}"
                                      VerticalContentAlignment="Center"
                                      HorizontalContentAlignment="Left"
                                      VerticalAlignment="Top"
                                      IsSynchronizedWithCurrentItem="True"
                                      IsTabStop="False"
                                      Style="{StaticResource NavigationMenu}" Margin="0,0,0,0">

                                <ListView.Template>
                                    <ControlTemplate>
                                        <Border BorderThickness="0" Background="Transparent">
                                            <ScrollViewer>
                                                <ItemsPresenter/>
                                            </ScrollViewer>
                                        </Border>
                                    </ControlTemplate>
                                </ListView.Template>

                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Background="Transparent" Height="40" VerticalAlignment="Center" Width="Auto" Margin="5,3,5,5">
                                            <Image Source="{Binding MenuIcon}" 
                                                   Height="44" Width="44" Stretch="Uniform" 
                                                   VerticalAlignment="Center" 
                                                   IsHitTestVisible="False"/>

                                            <TextBlock Text="{Binding MenuText}" 
                                                       FontSize="14" FontWeight="DemiBold" 
                                                       Foreground="{StaticResource Brush10}" 
                                                       Margin="4,-3,0,0" MaxWidth="220"
                                                       VerticalAlignment="Center" 
                                                       IsHitTestVisible="False"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListView.ItemTemplate>

                                <ListView.ItemContainerStyle>
                                    <Style TargetType="{x:Type ListViewItem}">
                                        <Style.Setters>
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="{x:Type ListViewItem}">
                                                        <Grid Background="{TemplateBinding Background}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" >
                                                            <TextBlock Foreground="{TemplateBinding Foreground}" HorizontalAlignment="Left" VerticalAlignment="Center">
                                                                <ContentPresenter />
                                                            </TextBlock>
                                                        </Grid>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style.Setters>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Foreground" Value="{StaticResource NavigationBarSelectionText}" />
                                                <Setter Property="Background" Value="{StaticResource NavigationBarMouseOver}" />
                                            </Trigger>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter Property="Foreground" Value="{StaticResource NavigationBarSelectionText}" />
                                                <Setter Property="Background" Value="{StaticResource NavigationBarCurrentSelection}" />
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </ListView.ItemContainerStyle>

                            </ListView>

                        </Grid>
                        <!--#endregion-->

                    </Grid>
                </Grid>

                <!--#region bottom status bar-->
                <DockPanel Grid.Row="4" Grid.Column="0" LastChildFill="True"
                        MouseLeftButtonDown="mouseLeftButtonDown_DragMove">
                    <Grid Background="{StaticResource Brush02}" VerticalAlignment="Center" Margin="0,0,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition/>
                            <RowDefinition/>
                        </Grid.RowDefinitions>

                        <Border Grid.Column="0" Grid.Row="0" Grid.ColumnSpan="2" BorderBrush="{StaticResource Brush03}" BorderThickness="0,0.5,0,0"/>

                        <!--#region comms status-->
                        <Grid Grid.Column="0" Grid.Row="1" Height="22.5">

                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="15,0,0,3"
                                        Visibility="{Binding CurrentPageIsConfigurator, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                                        ToolTip="{Binding CommsStatus, Converter={StaticResource ConnectionStatusToStringConverter}}">

                                <TextBlock Text="{Binding Path=Comms_Panel_Status, Source={StaticResource Resources}}" Foreground="{StaticResource Brush09}" Opacity="0.6" FontSize="13" Margin="0"/>

                                <StackPanel Orientation="Horizontal" Visibility="{Binding FirmwareError, Converter={StaticResource InverseBoolToVisibilityConverter}}">

                                    <Border CornerRadius="5" 
                                            Visibility="{Binding PanelIsDisconnected, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                                            Background="{Binding CommsStatus, Converter={StaticResource ConnectionStatusToBrushConverter}}" 
                                            Height="10" Width="10" Margin="7,3,5,0"/>
                                    <ctc:Icon IconType="DisconnectedSerial" 
                                              Visibility="{Binding PanelIsDisconnected, Converter={StaticResource BoolToVisibilityConverter}}"
                                              Foreground="{StaticResource BrushWarn}" Width="16" Height="16" Margin="5,2,0,0"/>
                                    <Grid Visibility="{Binding PanelIsConnected, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <ctc:Icon IconType="Locked" 
                                                  Visibility="{Binding PanelIsReadOnly, Converter={StaticResource BoolToVisibilityConverter}}"
                                                  Foreground="{StaticResource BrushWarn}" Width="14" Height="14" Margin="5,2,0,0"/>
                                    </Grid>
                                    
                                </StackPanel>

                                <!--warning-->
                                <ctc:Icon IconType="Warning" 
                                          Visibility="{Binding FirmwareError, Converter={StaticResource BoolToVisibilityConverter}}"
                                          Foreground="{StaticResource BrushWarn}"
                                          Margin="5,2,0,0" Width="16" Height="16"/>
                                
                            </StackPanel>

                        </Grid>
                        <!--#endregion-->

                        <ctc:Icon Grid.Column="1" Grid.Row="1" IconType="DebugMode"
                                  Visibility="{Binding DebugMode, Converter={StaticResource BoolToVisibilityConverter}}"
                                  Foreground="{StaticResource BrushDebug}" 
                                  Opacity="0.8"
                                  VerticalAlignment="Center" Height="18" Width="18" Margin="0,-3,5,0"/>

                    </Grid>
                </DockPanel>
                <!--#endregion-->

                <!--#endregion-->


                <!--#region header panel -->
                <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Vertical" MouseLeftButtonDown="mouseLeftButtonDown_DragMove">

                    <Border BorderBrush="{StaticResource Brush03}" BorderThickness="0,1,0,0" VerticalAlignment="Top"/>

                    <Grid Background="{StaticResource Brush07}" MinHeight="75">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!--#region Panel config header controls-->
                        <Grid Grid.Column="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <WrapPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Top" Margin="0,8,10,0" Grid.ColumnSpan="2">

                                <!--#region system name, panel num, enable changes-->
                                <Grid VerticalAlignment="Top">
                                    <Grid.RowDefinitions>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition/>
                                        <ColumnDefinition/>
                                        <ColumnDefinition/>
                                    </Grid.ColumnDefinitions>

                                    <!--#region site/system name-->
                                    <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal">
                                        <Border Background="{StaticResource Brush06}" BorderThickness="0" CornerRadius="0" Height="25" Margin="0,4,0,0" Padding="0" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Path=System_Name, Source={StaticResource Resources}}" FontSize="12" FontWeight="Bold" Foreground="{StaticResource Brush02}" TextWrapping="NoWrap" Margin="10,0,3,1" Padding="0"/>
                                        </Border>
                                        <Border Background="{StaticResource Brush08}" 
                                                BorderBrush="{StaticResource Brush06}" 
                                                BorderThickness="2" 
                                                CornerRadius="0,11,11,0"
                                                Height="25" Margin="0,4,0,0"
                                                VerticalAlignment="Center">
                                            <TextBlock Text="{Binding SystemName, Converter={StaticResource TrimmedStringConverter}}"
                                                       Background="Transparent"
                                                       Foreground="{StaticResource Brush03}"
                                                       VerticalAlignment="Center"
                                                       Height="18" MinWidth="80"
                                                       FontSize="12" FontWeight="ExtraBlack"
                                                       Margin="3,1,8,0"/>
                                        </Border>
                                    </StackPanel>
                                    <!--#endregion-->

                                    <!--#region panel number-->
                                    <StackPanel Grid.Row="0" Grid.Column="1" Grid.RowSpan="2" Orientation="Vertical" 
                                                Margin="25,0,0,0"
                                                ToolTip="{Binding PanelNumberToolTip}"
                                                Visibility="{Binding HeaderPanelEnabled, Converter={StaticResource BoolToVisibilityHiddenConverter}}">
                                        <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Left">
                                            <Border Background="{StaticResource Brush02}" BorderThickness="0" CornerRadius="0" 
                                                    Height="25" Margin="0,4,0,0" Padding="0" 
                                                    VerticalAlignment="Center">
                                                <Grid>
                                                    <TextBlock Text="{Binding Path=Panel, Source={StaticResource Resources}}" 
                                                               HorizontalAlignment="Center" VerticalAlignment="Center" 
                                                               FontSize="12" FontWeight="Bold" Foreground="{StaticResource Brush09}" Margin="5,0,5,0"/>
                                                </Grid>
                                            </Border>
                                            <Border Background="{StaticResource Brush10}" 
                                                    BorderBrush="{StaticResource Brush02}" 
                                                    BorderThickness="2" 
                                                    CornerRadius="0,11,11,0"
                                                    Margin="0,4,0,0"
                                                    VerticalAlignment="Center">
                                                <Grid>
                                                    <ctc:NumberSpinner Grid.Row="4" Grid.Column="1" 
                                                                       x:Name="PanelControl"
                                                                       Value="{Binding PanelNumber}"
                                                                       NumberSet="{Binding PanelNumberSet}"
                                                                       ShowNumberSetTotal="true"
                                                                       HorizontalAlignment="Left" 
                                                                       Height="22"
                                                                       FontSize="16"
                                                                       FontFamily="Arial"
                                                                       FontWeight="ExtraBold"
                                                                       Background="Transparent"
                                                                       BorderColour="Transparent"
                                                                       Margin="0,-1,4,0"/>
                                                </Grid>
                                            </Border>
                                        </StackPanel>

                                        <Button x:Name="btnPanels"
                                                Content="{Binding Path=Manage_Panels, Source={StaticResource Resources}}"
                                                FontSize="10" 
                                                HorizontalAlignment="Center" VerticalAlignment="Center"
                                                IsEnabled="{Binding IsReadOnly, Converter={StaticResource BoolToInverseConverter}}"
                                                PreviewMouseDown="PanelManagement_PreviewMouseDown"
                                                Height="22" Margin="0,5,0,0" Padding="0">
                                            <Button.Style>

                                                <Style TargetType="{x:Type Button}">
                                                    <Setter Property="Foreground" Value="{StaticResource NormalTextBrush}"/>
                                                    <Setter Property="Background" Value="{StaticResource Brush09}"/>
                                                    <Setter Property="Margin" Value="0"/>
                                                    <Setter Property="Template">
                                                        <Setter.Value>
                                                            <ControlTemplate TargetType="Button">
                                                                <Border Name="Border" 
                                                                        Background="{StaticResource Brush09}"
                                                                        BorderBrush="{StaticResource NormalBorderBrush}"
                                                                        BorderThickness="2"
                                                                        CornerRadius="5"
                                                                        Padding="5,0,0,1">
                                                                    <Grid>
                                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Name="content"/>
                                                                    </Grid>
                                                                </Border>
                                                                <ControlTemplate.Triggers>
                                                                    <Trigger Property="IsMouseOver" Value="true">
                                                                        <Setter TargetName="Border" Property="Background" Value="{StaticResource MouseOverButtonBackgroundBrush}" />
                                                                        <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource PressedBorderBrush}" />
                                                                        <Setter Property="Foreground" Value="{StaticResource FocusedTextBrush}"/>
                                                                    </Trigger>
                                                                    <Trigger Property="IsPressed" Value="true">
                                                                        <Setter TargetName="Border" Property="Background" Value="{StaticResource PressedButtonBackgroundBrush}" />
                                                                        <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource PressedBorderBrush}" />
                                                                        <Setter Property="Foreground" Value="{StaticResource FocusedTextBrush}"/>
                                                                    </Trigger>
                                                                    <Trigger Property="IsEnabled" Value="false">
                                                                        <Setter TargetName="Border" Property="Background" Value="Transparent" />
                                                                        <Setter Property="Opacity" Value="0.4"/>
                                                                    </Trigger>
                                                                </ControlTemplate.Triggers>
                                                            </ControlTemplate>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Style>
                                            </Button.Style>

                                        </Button>

                                    </StackPanel>
                                    <!--#endregion-->

                                    <!--enable changes-->
                                    <CheckBox Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3"
                                              Content="{Binding Path=Enable_Changes, Source={StaticResource Resources}}" 
                                              IsChecked="{Binding IsReadOnly, Converter={StaticResource BoolToInverseConverter}}" 
                                              Opacity="{Binding HeaderPanelEnabled, Converter={StaticResource BoolToOpacity40pcConverter}}"
                                              HorizontalAlignment="Left" FontSize="12" Margin="20,10,0,0"/>
                                </Grid>
                                <!--#endregion-->

                                <!--#region upload/download system data-->
                                <StackPanel Orientation="Horizontal" Margin="5,0,5,0"
                                            Visibility="{Binding HeaderPanelEnabled, Converter={StaticResource BoolToVisibilityHiddenConverter}}">
                                    <Button Background="Transparent" BorderThickness="0" 
                                            Click="downloadSystem_Click" 
                                            WindowChrome.IsHitTestVisibleInChrome="True"
                                            Style="{StaticResource HeaderButton}" VerticalAlignment="Top" Margin="0,2,0,2">
                                        <StackPanel Orientation="Vertical" VerticalAlignment="Center" Margin="2,3,2,0">
                                            <Image Source="/UI/Images/download-all.png" Height="25"/>
                                            <TextBlock Text="{Binding Path=Download_System, Source={StaticResource Resources}}" Style="{StaticResource HeaderButtonLabel}" Width="90" />
                                        </StackPanel>
                                    </Button>
                                    <Button Background="Transparent" BorderThickness="0" 
                                            Click="uploadSystem_Click" 
                                            WindowChrome.IsHitTestVisibleInChrome="True"
                                            Style="{StaticResource HeaderButton}" VerticalAlignment="Top" Margin="0,2,0,2">
                                        <StackPanel Orientation="Vertical" VerticalAlignment="Center" Margin="2,3,2,0">
                                            <Image Source="/UI/Images/upload-all.png" Height="25"/>
                                            <TextBlock Text="{Binding Path=Upload_System, Source={StaticResource Resources}}" Style="{StaticResource HeaderButtonLabel}" Width="90" />
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                                <!--#endregion-->

                                <!--#region upload/download current page/loop data-->
                                <StackPanel Orientation="Horizontal" Margin="5,2,5,2"
                                            Visibility="{Binding HeaderPanelEnabled, Converter={StaticResource BoolToVisibilityHiddenConverter}}">
                                    <Button Background="Transparent" BorderThickness="0" 
                                            Click="downloadPage_Click" 
                                            WindowChrome.IsHitTestVisibleInChrome="True"
                                            Style="{StaticResource HeaderButton}" VerticalAlignment="Top" Margin="0,0,0,0">
                                        <StackPanel Orientation="Vertical">
                                            <Border Grid.Column="1" Style="{StaticResource HeaderPanelControlsBorder}" CornerRadius="13,0,0,13" Margin="2,3,0,0" Height="25" Width="90">
                                                <Image Source="/UI/Images/download-single.png" Height="20" />
                                            </Border>
                                            <TextBlock Text="{Binding Path=Download_Page, Source={StaticResource Resources}}"
                                                       Style="{StaticResource HeaderButtonLabel}" Width="90"/>
                                        </StackPanel>
                                    </Button>
                                    <Button Background="Transparent" BorderThickness="0" 
                                            Click="uploadPage_Click" 
                                            WindowChrome.IsHitTestVisibleInChrome="True"
                                            Style="{StaticResource HeaderButton}" VerticalAlignment="Top" Margin="-1,0,0,0">
                                        <StackPanel Orientation="Vertical">
                                            <Border Grid.Column="1" Style="{StaticResource HeaderPanelControlsBorder}" CornerRadius="0,13,13,0" Height="25" Width="90" Margin="0,3,2,0" >
                                                <Image Source="/UI/Images/upload-single.png" Height="20" />
                                            </Border>
                                            <TextBlock Text="{Binding Path=Upload_Page, Source={StaticResource Resources}}" 
                                                       Style="{StaticResource HeaderButtonLabel}" Width="90" />
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                                <!--#endregion-->

                            </WrapPanel>


                            <StackPanel Grid.Column="3" Orientation="Horizontal">

                                <!--#region download log-->
                                <!--<Border Visibility="{Binding DebugMode, Converter={StaticResource BoolToVisibilityConverter}}"
                                        ToolTip="{Binding Path=ToolTip_View_Last_Comms_Log, Source={StaticResource Resources}}"
                                        Style="{StaticResource HeaderPanelControlsBorderi}"
                                        BorderBrush="{StaticResource Brush02}" BorderThickness="1"
                                        Background="{StaticResource BrushDebug}"
                                        WindowChrome.IsHitTestVisibleInChrome="True"
                                        VerticalAlignment="Top" Margin="0,22,16,0"
                                        MouseDown="commsLog_MouseDown">
                                    <ctc:Icon IconType="CommsLog" Foreground="{StaticResource Brush02}" Width="18" Height="18" Margin="0,3,2,3"/>
                                </Border>-->
                                <!--#endregion-->

                                <!--#region info-->
                                <Border Grid.Column="3" 
                                        ToolTip="{Binding Path=Check_Validity_Of_Panel_Data, Source={StaticResource Resources}}"
                                        Style="{StaticResource HeaderPanelControlsBorderi}"
                                        Visibility="{Binding HeaderPanelEnabled, Converter={StaticResource BoolToVisibilityHiddenConverter}}"
                                        WindowChrome.IsHitTestVisibleInChrome="True"
                                        HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,22,10,0"
                                        MouseDown="info_MouseDown">
                                    <TextBlock Text="{Binding Path=Info_Abbr, Source={StaticResource Resources}}" Style="{StaticResource HeaderPanelControlsInfoi}" HorizontalAlignment="Center"/>
                                </Border>
                                <!--#endregion-->

                            </StackPanel>
                        </Grid>
                        <!--#endregion-->


                        <!--#region main menu button-->
                        <CheckBox Grid.Column="2" x:Name="MainMenuButton" 
                                  Style="{StaticResource HeaderMainMenuCheckBox}" 
                                  WindowChrome.IsHitTestVisibleInChrome="True"
                                  IsChecked="{Binding MainMenuIsOpen}"
                                  Height="30" Padding="4,5,4,5" VerticalAlignment="Top" Margin="20,24,14,0">
                            <CheckBox.Template>
                                <ControlTemplate TargetType="CheckBox">
                                    <Grid Background="Transparent">
                                        <Viewbox Width="25" Height="25">
                                            <Path StrokeThickness="4" StrokeStartLineCap="Round" StrokeEndLineCap="Round" 
                                                  Data="M 2 2 L 26 2 M 2 10 L 26 10 M 2 18 L 26 18">
                                                <Path.Stroke>
                                                    <SolidColorBrush Color="{StaticResource Colour02}"/>
                                                </Path.Stroke>
                                            </Path>
                                        </Viewbox>
                                    </Grid>
                                </ControlTemplate>
                            </CheckBox.Template>
                        </CheckBox>
                        <!--#endregion-->

                    </Grid>

                    <Border BorderBrush="{StaticResource Brush07}" Background="{StaticResource Brush10}" BorderThickness="0,0,0,2" Height="4" VerticalAlignment="Top"/>

                </StackPanel>
                <!--#endregion-->


                <!--#region main content + bottom bar-->
                <DockPanel Grid.Row="2" Grid.Column="1" Grid.RowSpan="3" LastChildFill="True" PreviewMouseDown="MainPanel_PreviewMouseDown">
                    <Border Background="Transparent" BorderBrush="{StaticResource Brush02}" BorderThickness="0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!--#region main content-->
                            <Frame Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Style="{StaticResource MainContentFrame}" Margin="0" Content="{Binding CurrentPage}"/>
                            <!--#endregion-->

                            <!--#region filename-->
                            <Grid Grid.Row="1" Grid.Column="0" Background="{StaticResource Brush07}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding CurrentFileName}" 
                                               Foreground="{StaticResource Brush00}" Opacity="0.6" 
                                               FontSize="13"  Height="21" Margin="10,1,0,1"
                                               HorizontalAlignment="Left" VerticalAlignment="Center" 
                                               ToolTip="{Binding CurrentFilePath}"/>
                                    <Grid Visibility="{Binding CurrentFileName, Converter={StaticResource NonNullToVisibilityConverter}}">
                                        <TextBlock Text="*" 
                                                   Visibility="{Binding DataHasChanged, Converter={StaticResource BoolToVisibilityConverter}}"
                                                   Foreground="{StaticResource Brush00}" Opacity="0.6" 
                                                   FontSize="13"  Height="21" 
                                                   HorizontalAlignment="Left" VerticalAlignment="Center" 
                                                   ToolTip="{Binding CurrentFilePath}"/>
                                    </Grid>
                                </StackPanel>
                            </Grid>
                            <!--#endregion-->

                            <!--#region protocol name-->
                            <Border Grid.Row="1" Grid.Column="1" 
                                    Background="{StaticResource Brush07}" BorderBrush="{StaticResource Brush04}" BorderThickness="1,0,0,0" 
                                    MouseDown="Protocol_MouseDown" 
                                    Cursor="Hand" 
                                    ToolTip="{Binding Path=ToolTip_Double_Click_For_Protocol_Menu, Source={StaticResource Resources}}">
                                <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Background="{StaticResource Brush07}"
                                            VerticalAlignment="Top" HorizontalAlignment="Right" Margin="10,2,10,0">
                                <TextBlock Text="{Binding Path=Protocol_Header, Source={StaticResource Resources}}" Foreground="{StaticResource Brush02}" Opacity="0.8" FontSize="13" Margin="0,0,3,0" />
                                <TextBlock Text="{Binding ProtocolName}" Foreground="{StaticResource Brush02}" Opacity="0.8" FontSize="13" FontWeight="Bold" Margin="0"/>
                                </StackPanel>
                            </Border>
                            <!--#endregion-->

                        </Grid>
                    </Border>
                </DockPanel>
                <!--#endregion-->


                <!--#region protocol (at top of screen - not used)-->
                <!--<StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" 
                            MouseDown="Protocol_MouseDown" 
                            Cursor="Hand" 
                            ToolTip="{Binding Path=ToolTip_Double_Click_For_Protocol_Menu, Source={StaticResource Resources}}"
                            VerticalAlignment="Top" HorizontalAlignment="Right" Margin="10,2,10,0">
                    <TextBlock Text="{Binding Path=Protocol_Header, Source={StaticResource Resources}}" Foreground="{StaticResource Brush06}" FontSize="13" Margin="0,0,3,0" />
                    <TextBlock Text="{Binding ProtocolName}" Foreground="{StaticResource Brush06}" FontSize="13" FontWeight="DemiBold" Margin="0"/>
                </StackPanel>-->
                <!--#endregion-->

                
                <!--#region main menu-->
                <ctc:HamburgerMenu Grid.Row="2" Grid.Column="1" Grid.RowSpan="3"
                                   x:Name="hbgMainMenu"
                                   IsOpen="{Binding IsChecked, ElementName=MainMenuButton}"
                                   OpenCloseDuration="0:0:0.1"
                                   HorizontalAlignment="Right"
                                   FallbackOpenWidth="220"
                                   Background="{StaticResource Brush03}" 
                                   BorderThickness="1,0,0,0"
                                   BorderBrush="{StaticResource Brush06}"
                                   Margin="0,-4,0,0">

                    <ctc:HamburgerMenu.Content>
                        <StackPanel Orientation="Vertical" x:Name="spMainMenu">

                            <!--#region File menu-->
                            <ctc:HamburgerMenuItem IconType="File"/>

                            <ctc:HamburgerMenuOption IconType="NewFile" PreviewMouseDown="FileNew_MouseDown"/>
                            <ctc:HamburgerMenuOption IconType="OpenFile" PreviewMouseDown="FileOpen_MouseDown"/>
                            <ctc:HamburgerMenuOption IconType="SaveFile" PreviewMouseDown="FileSave_MouseDown"/>
                            <ctc:HamburgerMenuOption IconType="SaveFileAs" PreviewMouseDown="FileSaveAs_MouseDown"/>

                            <!--#region recent files-->
                            <StackPanel Orientation="Vertical" Visibility="{Binding RecentFilesListAvailable, Converter={StaticResource BoolToVisibilityConverter}}">

                                <ctc:HamburgerMenuOption x:Name="mnuRecentFiles" IconType="RecentFiles" Submenu="{Binding ElementName=mnuRecentFilesSubmenu}"/>

                                <ctc:HamburgerMenu x:Name="mnuRecentFilesSubmenu"
                                                   Width="{Binding Width, ElementName=hbgMainMenu}"
                                                   OpenCloseDuration="0:0:0.1"
                                                   HorizontalAlignment="Left"
                                                   SlideDirection="UpDown"
                                                   FallbackOpenWidth="200"
                                                   Margin="0,0,0,2">

                                    <ctc:HamburgerMenu.Content>

                                        <ListView ItemsSource="{Binding RecentFilesList}"
                                                  Background="Transparent"
                                                  BorderThickness="0"
                                                  ScrollViewer.HorizontalScrollBarVisibility="Hidden">

                                            <ListView.Template>
                                                <ControlTemplate>
                                                    <Border Background="Transparent" BorderThickness="0">
                                                        <ItemsPresenter/>
                                                    </Border>
                                                </ControlTemplate>
                                            </ListView.Template>

                                            <ListView.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid Background="Transparent" 
                                                          VerticalAlignment="Center" 
                                                          MouseDown="recentFile_MouseDown">
                                                        <TextBlock Text="{Binding Text}" 
                                                                   Tag="{Binding Tag}"
                                                                   ToolTip="{Binding ToolTip}"
                                                                   FontSize="14" Margin="0,2,0,0" Padding="50,2,5,2"
                                                                   Background="Transparent"
                                                                   Foreground="{StaticResource Brush10}" 
                                                                   VerticalAlignment="Center" 
                                                                   TextWrapping="NoWrap"
                                                                   MouseDown="recentFile_MouseDown"/>
                                                        <Grid.ContextMenu>
                                                            <ContextMenu StaysOpen="False" VerticalOffset="5" HasDropShadow="True">
                                                                <ContextMenu.Template>
                                                                    <ControlTemplate TargetType="{x:Type ContextMenu}">
                                                                        <Border x:Name="Border" Background="{StaticResource Brush10}" BorderBrush="{StaticResource Brush02}" BorderThickness="1.5" CornerRadius="3" Cursor="Hand">
                                                                            <Grid IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Cycle" Style="{DynamicResource ContextMenuItemStyle}" Margin="1"/>
                                                                        </Border>
                                                                    </ControlTemplate>
                                                                </ContextMenu.Template>
                                                                <MenuItem Tag="{Binding Tag}" Foreground="{StaticResource Brush03}" PreviewMouseDown="recentFilesMenuItem_PreviewMouseDown">
                                                                    <MenuItem.Template>
                                                                        <ControlTemplate>
                                                                            <TextBlock Text="{Binding Path=Menu_Remove_File_From_List, Source={StaticResource Resources}}" Padding="7,2,3,2"/>
                                                                        </ControlTemplate>
                                                                    </MenuItem.Template>
                                                                </MenuItem>
                                                            </ContextMenu>
                                                        </Grid.ContextMenu>
                                                    </Grid>
                                                </DataTemplate>
                                            </ListView.ItemTemplate>

                                            <ListView.ItemContainerStyle>
                                                <Style TargetType="{x:Type ListViewItem}">
                                                    <Style.Setters>
                                                        <Setter Property="Template">
                                                            <Setter.Value>
                                                                <ControlTemplate TargetType="{x:Type ListViewItem}">
                                                                    <Grid Background="{TemplateBinding Background}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" >
                                                                        <TextBlock Foreground="{TemplateBinding Foreground}" HorizontalAlignment="Left" VerticalAlignment="Center"> 
                                                                            <ContentPresenter />
                                                                        </TextBlock>
                                                                    </Grid>
                                                                </ControlTemplate>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Style.Setters>
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="#80a7ff" />
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </ListView.ItemContainerStyle>

                                        </ListView>
                                        
                                    </ctc:HamburgerMenu.Content>
                                </ctc:HamburgerMenu>

                            </StackPanel>
                            <!--#endregion-->

                            <!--#endregion-->

                            <ctc:HamburgerMenuSeparator/>

                            <!--#region Print option-->
                            <ctc:HamburgerMenuSubheader x:Name="mnuPrint" IconType="Print" FontSize="18" PreviewMouseDown="Print_MouseDown"/>
                            <ctc:HamburgerMenuSeparator/>
                            <!--#endregion-->

                            <!--#region Settings menu-->
                            <ctc:HamburgerMenuItem IconType="Settings"/>

                            <!--#region serial port-->
                            <ctc:HamburgerMenuOption x:Name="mnuSerialPort" IconType="SerialPort" Submenu="{Binding ElementName=mnuSerialPortOptions}"/>
                            <ctc:HamburgerMenu x:Name="mnuSerialPortOptions"
                                               Width="{Binding Width, ElementName=hbgMainMenu}"
                                               OpenCloseDuration="0:0:0.1"
                                               HorizontalAlignment="Left"
                                               SlideDirection="UpDown"
                                               FallbackOpenWidth="100"
                                               Height="20"
                                               Margin="0,2,0,2">

                                <ctc:HamburgerMenu.Content>
                                    <StackPanel Orientation="Vertical">
                                        <StackPanel Orientation="Horizontal" Margin="50,0,10,5" ToolTip="{Binding ToolTip_SelectCOMPort}">

                                            <!--<Viewbox Width="24" Margin="0,-5,10,0">
                                                <Path Fill="{StaticResource Brush10}" Data="{Binding SerialPortNameIconPathData}"/>
                                            </Viewbox>-->
                                            <ctc:Icon IconType="PortName" Foreground="{StaticResource Brush10}" Width="20" Height="20" Margin="0,-4,10,0"/>
                                            
                                            <StackPanel Orientation="Horizontal" Visibility="{Binding NoPortsAvailable, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                                                <TextBlock Text="{Binding Path=Serial_Port_Name, Source={StaticResource Resources}}" 
                                                           Foreground="{StaticResource Brush10}" 
                                                           FontSize="14"
                                                           VerticalAlignment="Top" Margin="0"/>

                                                <ComboBox ItemsSource="{Binding PortNamesList}"
                                                          SelectedIndex="{Binding PortNameIndex}"
                                                          Opacity="0.9"
                                                          Margin="5,2,0,0" MinWidth="70" HorizontalAlignment="Left"
                                                          PreviewMouseDown="showPortsComboBoxDropdown"/>
                                            </StackPanel>
                                            <TextBlock Text="{Binding Path=No_Ports_Available, Source={StaticResource Resources}}" 
                                                       Visibility="{Binding NoPortsAvailable, Converter={StaticResource BoolToVisibilityConverter}}" 
                                                       Foreground="{StaticResource BrushError}" 
                                                       Background="{StaticResource Brush06}" 
                                                       FontStyle="Italic"
                                                       Padding="10,0,12,2"
                                                       Margin="0" />

                                        </StackPanel>

                                        <StackPanel Orientation="Vertical" Opacity="{Binding NoPortsAvailable, Converter={StaticResource InverseBoolToOpacity40pcConverter}}" IsEnabled="{Binding NoPortsAvailable, Converter={StaticResource BoolToInverseConverter}}">
                                            <Grid Visibility="{Binding PanelIsConnected, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                                                <ctc:HamburgerMenuOption x:Name="mnuConnect" IconType="ConnectSerial" PreviewMouseDown="ConnectSerial_MouseDown" Margin="0,0,0,0" Padding="30,0,0,0"/>
                                            </Grid>
                                            <Grid Visibility="{Binding PanelIsConnected, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <ctc:HamburgerMenuOption x:Name="mnuDisconnect" IconType="DisconnectSerial" PreviewMouseDown="DisconnectSerial_MouseDown" IsEnabled="{Binding SerialPortIsIdle}" Margin="0,0,0,0" Padding="30,0,0,0"/>
                                            </Grid>
                                        </StackPanel>
                                        
                                    </StackPanel>
                                </ctc:HamburgerMenu.Content>
                            </ctc:HamburgerMenu>
                            <!--#endregion-->

                            <!--#region language menu-->
                            <Grid Visibility="{Binding LanguageSelectionAvailable, Converter={StaticResource BoolToVisibilityConverter}}">
                                <ctc:HamburgerMenuOption x:Name="mnuLanguage" IconType="Language" PreviewMouseDown="SelectLanguage_PreviewMouseDown"/>
                            </Grid>
                            <!--#endregion-->

                            <!--#region Protocols-->
                            <ctc:HamburgerMenuOption x:Name="mnuProtocol" IconType="Protocol" Submenu="{Binding ElementName=mnuProtocols}"/>
                            <ctc:HamburgerMenu x:Name="mnuProtocols"
                                               Width="{Binding Width, ElementName=mnuProtocol}"
                                               OpenCloseDuration="0:0:0.1"
                                               HorizontalAlignment="Left"
                                               FallbackOpenWidth="220"
                                               SlideDirection="UpDown"
                                               Margin="0,0,0,0">

                                <ctc:HamburgerMenu.Content>
                                    <Grid>
                                        <!--this border is used to highlight the options if protocol indicator on bottom bar is double-clicked-->
                                        <Border Background="{StaticResource Brush04}"
                                                BorderBrush="{StaticResource BrushOk}"
                                                BorderThickness="3" CornerRadius="5" 
                                                Visibility="{Binding ProtocolsHighlightVisibility}"
                                                Opacity="0.7"
                                                Margin="45,1,0,-1" >
                                        </Border>

                                        <StackPanel Orientation="Vertical" Margin="50,0,0,0" >

                                            <StackPanel Orientation="Horizontal">
                                                <CheckBox Width="20" Height="20" Margin="5,7,5,0" IsChecked="{Binding CurrentProtocolIsCast}" Opacity="0.8"/>
                                                <TextBlock Text="{Binding CastProtocol}" Foreground="{StaticResource Brush10}" Opacity="0.7" FontSize="14" Height="22" Margin="0,2,10,0"/>
                                            </StackPanel>

                                            <StackPanel Orientation="Horizontal">
                                                <CheckBox Width="20" Height="20" Margin="5,7,5,0" IsChecked="{Binding CurrentProtocolIsApollo}" Opacity="0.8"/>
                                                <TextBlock Text="{Binding ApolloProtocol}" Foreground="{StaticResource Brush10}" Opacity="0.7" FontSize="14" Height="22" Margin="0,2,10,0"/>
                                            </StackPanel>

                                            <!--<StackPanel Orientation="Horizontal">
                                                <CheckBox Width="20" Height="20" Margin="5,7,5,0" IsChecked="{Binding CurrentProtocolIsHochiki}" Opacity="0.8"/>
                                                <TextBlock Text="{Binding HochikiProtocol}" Foreground="{StaticResource Brush10}" Opacity="0.7" FontSize="14" Height="22" Margin="0,2,10,0"/>
                                            </StackPanel>-->

                                        </StackPanel>
                                    </Grid>
                                </ctc:HamburgerMenu.Content>

                            </ctc:HamburgerMenu>
                            <!--#endregion-->

                            <!--#endregion-->

                            <ctc:HamburgerMenuSeparator/>

                            <!--#region View menu-->
                            <ctc:HamburgerMenuSubheader x:Name="mnuView" IconType="View" Submenu="{Binding ElementName=mnuViewOptions}" FontSize="18"/>
                            <ctc:HamburgerMenu x:Name="mnuViewOptions"
                                                Width="{Binding Width, ElementName=hbgMainMenu}"
                                                OpenCloseDuration="0:0:0.1"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Top"
                                                FallbackOpenWidth="220"
                                                SlideDirection="UpDown"
                                                Margin="0,0,0,0">
                                <ctc:HamburgerMenu.Content>
                                    <StackPanel Orientation="Vertical">
                                        <ctc:HamburgerMenuOption IconType="ZoomLevel" PreviewMouseDown="Zoom_PreviewMouseDown"/>
                                        <ctc:HamburgerMenuOption IconType="CommsLog" PreviewMouseDown="CommsLog_PreviewMouseDown"/>
                                        <ctc:HamburgerMenuOption IconType="Info" PreviewMouseDown="Data_PreviewMouseDown"/>
                                    </StackPanel>
                                </ctc:HamburgerMenu.Content>
                            </ctc:HamburgerMenu>
                            <!--#endregion-->

                            <ctc:HamburgerMenuSeparator/>

                            <!--#region Help menu-->
                            <ctc:HamburgerMenuSubheader x:Name="mnuHelp" IconType="Help" Submenu="{Binding ElementName=mnuHelpOptions}"/>
                            <ctc:HamburgerMenu x:Name="mnuHelpOptions"
                                               Width="{Binding Width, ElementName=hbgMainMenu}"
                                               OpenCloseDuration="0:0:0.1"
                                               HorizontalAlignment="Left"
                                               VerticalAlignment="Top"
                                               FallbackOpenWidth="220"
                                               SlideDirection="UpDown">
                                <ctc:HamburgerMenu.Content>
                                    <!-- NB: must put this single submenu item in a container else it won't be found when changing culture -->
                                    <StackPanel Orientation="Vertical">
                                        <ctc:HamburgerMenuOption IconType="About" PreviewMouseDown="About_PreviewMouseDown"/>
                                        <ctc:HamburgerMenuOption IconType="History" PreviewMouseDown="History_PreviewMouseDown"/>
                                        <!--<ctc:HamburgerMenuOption IconType="Register" PreviewMouseDown="Register_PreviewMouseDown"/>-->
                                    </StackPanel>
                                </ctc:HamburgerMenu.Content>
                            </ctc:HamburgerMenu>
                            <!--#endregion-->

                            <ctc:HamburgerMenuSeparator/>

                            <!--#region exit-->
                            <ctc:HamburgerMenuSubheader x:Name="mnuExit" IconType="Exit" PreviewMouseDown="Exit_PreviewMouseDown"/>
                            <!--#endregion-->

                            <!--#region invisible hotkey options-->
                            <ctc:HamburgerMenuOption IconType="SerialMonitor" Visibility="Collapsed"/>
                            <ctc:HamburgerMenuOption IconType="DebugMode" Visibility="Collapsed"/>
                            <!--#endregion-->

                            </StackPanel>
                    </ctc:HamburgerMenu.Content>
                </ctc:HamburgerMenu>

                <!--#endregion-->
                

                <!--#region overlays 'disable' the screen during comms-->
                <Grid Grid.Row="0" Grid.Column="1" Grid.ColumnSpan="4" Grid.RowSpan="2"
                      Background="#309090a0" 
                      Visibility="{Binding MainWindowEnabled, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                <Grid Grid.Row="2" Grid.Column="0" Grid.RowSpan="1" Grid.ColumnSpan="1"
                      Background="#00000000"
                      Visibility="{Binding MainWindowEnabled, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                <Grid Grid.Row="2" Grid.Column="1" Grid.RowSpan="4" Grid.ColumnSpan="2"
                      Background="#309090a0"
                      Visibility="{Binding MainWindowEnabled, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                <!--#endregion-->


                <!--#region control buttons -->
                <Grid Grid.Column="1" Grid.RowSpan="2"
                        HorizontalAlignment="Right" VerticalAlignment="Top" 
                        Background="Transparent" 
                        Height="18" Margin="0,1,-0.5,0">
                    <Grid.Style>
                        <Style>
                            <Style.Triggers>
                                <Trigger Property="Border.IsMouseOver" Value="False">
                                    <Setter Property="Border.Opacity" Value="0" />
                                </Trigger>
                                <Trigger Property="Border.IsMouseOver" Value="true">
                                    <Setter Property="Border.Opacity" Value="1" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>
                    <Grid Background="{StaticResource Brush07}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Button Grid.Column="0"
                                Width="30" Margin="0" 
                                BorderBrush="Transparent"
                                ToolTip="{Binding Path=Control_Button_Minimise, Source={StaticResource Resources}}"
                                Click="btnMinimise_Click">
                            <TextBlock Text="🗕" Margin="0,1,5,5" FontSize="13" Foreground="{StaticResource Brush03}"/>
                            <Button.Style>
                                <Style TargetType="{x:Type Button}">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="WindowChrome.IsHitTestVisibleInChrome" Value="True" />
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="{x:Type Button}">
                                                <Border Background="{TemplateBinding Background}">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="5,0,0,0"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{StaticResource Brush09}"/>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter Property="Background" Value="{StaticResource BrushControlButtonPressed}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        <Button Grid.Column="1" 
                                Width="30" Margin="0"
                                BorderBrush="Transparent"
                                ToolTip="{Binding Path=Control_Button_Maximise, Source={StaticResource Resources}}"
                                Visibility="{Binding WindowIsMaximised, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                                Click="btnMaximise_Click">
                            <TextBlock Text="🗖" Margin="0,1,5,5" FontSize="13" Foreground="{StaticResource Brush03}"/>
                            <Button.Style>
                                <Style TargetType="{x:Type Button}">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="WindowChrome.IsHitTestVisibleInChrome" Value="True" />
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="{x:Type Button}">
                                                <Border Background="{TemplateBinding Background}">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="5,0,0,0"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{StaticResource Brush09}"/>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter Property="Background" Value="{StaticResource BrushControlButtonPressed}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        <Button Grid.Column="1"
                                Width="30" Margin="0" 
                                BorderBrush="Transparent"
                                ToolTip="{Binding Path=Control_Button_Restore, Source={StaticResource Resources}}"
                                Visibility="{Binding WindowIsMaximised, Converter={StaticResource BoolToVisibilityConverter}}"
                                Click="btnRestore_Click" >
                            <TextBlock Text="🗗" Margin="0,1,5,5" FontSize="13" Foreground="{StaticResource Brush03}"/>
                            <Button.Style>
                                <Style TargetType="{x:Type Button}">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="WindowChrome.IsHitTestVisibleInChrome" Value="True" />
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="{x:Type Button}">
                                                <Border Background="{TemplateBinding Background}">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="5,0,0,0"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{StaticResource Brush09}"/>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter Property="Background" Value="{StaticResource BrushControlButtonPressed}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        <Button Grid.Column="2" 
                                Width="30" Margin="0" 
                                BorderBrush="Transparent" 
                                ToolTip="{Binding Path=Control_Button_Close, Source={StaticResource Resources}}"
                                Click="btnExit_Click">
                            <TextBlock Text="🗙" Margin="0,1,5,5" FontSize="13" Foreground="{StaticResource Brush03}"/>
                            <Button.Style>
                                <Style TargetType="{x:Type Button}">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="WindowChrome.IsHitTestVisibleInChrome" Value="True" />
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="{x:Type Button}">
                                                <Border Background="{TemplateBinding Background}">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="5,0,0,0"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{StaticResource BrushClose}"/>
                                            <Setter Property="Foreground" Value="{StaticResource Brush10}"/>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter Property="Background" Value="{StaticResource BrushControlButtonPressed}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </Grid>
                </Grid>
                <!--#endregion-->


                
                
                <!--#region pop-ups-->

                <!--#region language selector pop-up-->
                <Popup x:Name="popLanguageSelector" 
                       IsOpen="{Binding LanguageSelectorIsOpen}" StaysOpen="{Binding LanguageSelectorStaysOpen}" 
                       Placement="RelativePoint" PlacementTarget="{Binding ElementName=mnuLanguage}" 
                       HorizontalOffset="-80" VerticalOffset="25" 
                       AllowsTransparency="True" 
                       PopupAnimation="Fade">
                    <Border Style="{StaticResource PopupBorder}" Padding="5">
                        <StackPanel Orientation="Vertical">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Label Grid.Column="0" Content="{Binding Path=Select_Language, Source={StaticResource Resources}}"/>
                                <ctc:CloseButton Grid.Column="1" Click="closeLanguage_Click" HorizontalAlignment="Right" Margin="0,-8,0,0"/>
                            </Grid>
                            <ListView ItemsSource="{Binding AvailableLanguages}" MinWidth="100" BorderThickness="0,1,0,0"/>
                        </StackPanel>
                    </Border>
                </Popup>
                <!--#endregion-->


                <!--#region zoom control pop-up-->
                <Popup x:Name="popZoomControl" 
                       IsOpen="{Binding ZoomControlIsOpen}" StaysOpen="True" 
                       Placement="Center" 
                       VerticalOffset="0" 
                       HorizontalOffset="0"
                       AllowsTransparency="True" 
                       PopupAnimation="Fade">
                    <Border Style="{StaticResource PopupBorder}" Background="{StaticResource Brush08}" Padding="2,0,0,2" >
                        <StackPanel Orientation="Vertical" >
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Label Grid.Column="0" Content="{Binding Path=Select_Zoom_Level, Source={StaticResource Resources}}" FontStyle="Italic" />
                                <ctc:CloseButton Grid.Column="1" Click="closeZoomControl" HorizontalAlignment="Right" Margin="0,-6,2,0"/>
                            </Grid>
                            <StackPanel Grid.Column="1" Grid.ColumnSpan="2" Orientation="Horizontal"  HorizontalAlignment="Center" VerticalAlignment="Center" Margin="7,4,5,4">
                                <TextBlock Text="–" Foreground="{StaticResource Brush04}" FontSize="10" Margin="0,0,4,3" MouseDown="zoomOut_MouseDown"/>
                                <Border Background="{StaticResource Brush10}" BorderBrush="{StaticResource Brush04}" BorderThickness="2" CornerRadius="3" >
                                    <Slider VerticalAlignment="Center"
                                            Template="{StaticResource HorizontalZoomSlider}"
                                            Value="{Binding ZoomLevel}" Minimum="{Binding MinZoom}" Maximum="{Binding MaxZoom}" SmallChange="{Binding ZoomStep}" LargeChange="{Binding LargeZoomStep}" TickFrequency="{Binding TickFrequency}" 
                                            Width="150" Height="18" Margin="0,0,0,0"/>
                                </Border>
                                <TextBlock Text="+" Foreground="{StaticResource Brush04}" FontSize="12" Margin="2,0,2,3" MouseDown="zoomIn_MouseDown"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Popup>
                <!--#endregion-->


                <!--#region app info pop-up-->
                <Popup x:Name="popInfo" 
                       IsOpen="{Binding DataPopupIsOpen}" StaysOpen="False" 
                       Placement="MousePoint"  
                       VerticalOffset="-20" 
                       HorizontalOffset="-20"
                       AllowsTransparency="True" 
                       PopupAnimation="Fade">
                    <Border Style="{StaticResource PopupBorder}" Padding="5" >
                        <StackPanel Orientation="Vertical">
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Orientation="Vertical" >
                                    <StackPanel Grid.Column="0" Orientation="Horizontal" >
                                        <Path StrokeThickness="1.25"
                                              Data="M78.962,99.536l-1.559,6.373c-4.677,1.846-8.413,3.251-11.195,4.217c-2.785,0.969-6.021,1.451-9.708,1.451c-5.662,0-10.066-1.387-13.207-4.142c-3.141-2.766-4.712-6.271-4.712-10.523c0-1.646,0.114-3.339,0.351-5.064c0.239-1.727,0.619-3.672,1.139-5.846l5.845-20.688c0.52-1.981,0.962-3.858,1.316-5.633c0.359-1.764,0.532-3.387,0.532-4.848c0-2.642-0.547-4.49-1.636-5.529c-1.089-1.036-3.167-1.562-6.252-1.562c-1.511,0-3.064,0.242-4.647,0.71c-1.59,0.47-2.949,0.924-4.09,1.346l1.563-6.378c3.829-1.559,7.489-2.894,10.99-4.002c3.501-1.111,6.809-1.667,9.938-1.667c5.623,0,9.962,1.359,13.009,4.077c3.047,2.72,4.57,6.246,4.57,10.591c0,0.899-0.1,2.483-0.315,4.747c-0.21,2.269-0.601,4.348-1.171,6.239l-5.82,20.605c-0.477,1.655-0.906,3.547-1.279,5.676c-0.385,2.115-0.569,3.731-0.569,4.815c0,2.736,0.61,4.604,1.833,5.597c1.232,0.993,3.354,1.487,6.368,1.487c1.415,0,3.025-0.251,4.814-0.744C76.854,100.348,78.155,99.915,78.962,99.536z M80.438,13.03c0,3.59-1.353,6.656-4.072,9.177c-2.712,2.53-5.98,3.796-9.803,3.796c-3.835,0-7.111-1.266-9.854-3.796c-2.738-2.522-4.11-5.587-4.11-9.177c0-3.583,1.372-6.654,4.11-9.207C59.447,1.274,62.729,0,66.563,0c3.822,0,7.091,1.277,9.803,3.823C79.087,6.376,80.438,9.448,80.438,13.03z"
                                              HorizontalAlignment="Left" Height="16" Width="16" Stretch="Uniform" Margin="8,2,0,0">
                                            <Path.Fill>
                                                <SolidColorBrush Color="{StaticResource Colour03}"/>
                                            </Path.Fill>
                                        </Path>
                                        <TextBlock Text="{Binding Path=Information, Source={StaticResource Resources}}" FontSize="12" FontWeight="DemiBold" Margin="-2,5,0,-3"/>
                                    </StackPanel>
                                    <Border BorderThickness="0,0.75,0,0" BorderBrush="{StaticResource Brush07}" Margin="5,5,5,0"/>
                                </StackPanel>

                                <ctc:CloseButton Grid.Column="1" Click="closeData_Click" HorizontalAlignment="Right"/>
                            </Grid>

                            <Grid Margin="10,5,10,10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <StackPanel Grid.Row="0" Orientation="Horizontal">
                                    <TextBlock Text="{Binding Path=Data_Info_Loops_Detected, Source={StaticResource Resources}}" Foreground="{StaticResource Brush03}" HorizontalAlignment="Left" Margin="0,3,0,0"/>
                                    <TextBlock Text="{Binding DetectedLoops, Mode=OneWay, Converter={StaticResource IsNullToNAConverter}}" Foreground="{StaticResource Brush03}" FontWeight="SemiBold" Margin="5,3,10,0"/>
                                </StackPanel>

                                <StackPanel Grid.Row="1" Orientation="Horizontal">
                                    <TextBlock Text="{Binding Path=Data_Info_Device_Names, Source={StaticResource Resources}}" Foreground="{StaticResource Brush03}" HorizontalAlignment="Left" Margin="0,10,0,0"/>
                                    <TextBlock Text="{Binding DebugNamesUsed, Mode=OneWay}" Foreground="{StaticResource Brush03}" FontWeight="SemiBold" Margin="5,10,10,0"/>
                                </StackPanel>
                                <Grid Grid.Row="2">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Row="0" Text="{Binding Path=Data_Info_Bytes_Used, Source={StaticResource Resources}}" Foreground="{StaticResource Brush03}" FontSize="11" FontStyle="Italic" FontWeight="Light" Margin="10,0,0,0"/>
                                    <TextBlock Grid.Row="1" Text="{Binding Path=Data_Info_Bytes_Remaining, Source={StaticResource Resources}}" Foreground="{StaticResource Brush03}" FontSize="11" FontStyle="Italic" FontWeight="Light" Margin="10,0,0,3"/>
                                    <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding DebugNameBytesUsed, Mode=OneWay}" Foreground="{StaticResource Brush03}" FontSize="10" FontStyle="Italic" FontWeight="SemiBold" Margin="5,0,10,0"/>
                                    <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding DebugNameBytesRemaining, Mode=OneWay}" Foreground="{StaticResource Brush03}" FontSize="10" FontStyle="Italic" FontWeight="SemiBold" Margin="5,0,10,3"/>
                                </Grid>
                            </Grid>
                        </StackPanel>
                    </Border>
                </Popup>
                <!--#endregion-->

                
                <!--#region About pop-up-->
                <Popup x:Name="popAbout" 
                       IsOpen="{Binding AboutIsOpen}" StaysOpen="True" 
                       Placement="RelativePoint" PlacementTarget="{Binding ElementName=mnuHelpOptions}" 
                       VerticalOffset="-150" 
                       HorizontalOffset="-150"
                       AllowsTransparency="True" 
                       PopupAnimation="Fade">
                    <Border Style="{StaticResource PopupBorder}" Padding="5" >
                        <StackPanel Orientation="Vertical">
                            <ctc:CloseButton Click="closeAbout_Click" HorizontalAlignment="Right"/>
                            <Grid Margin="10,5,10,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="5"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="4" x:Name="txtAboutHeader" Text="{Binding AboutHeader}" Width="{Binding AboutHeaderWidth}" FontSize="16" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                
                                <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="4" Orientation="Vertical" Margin="0,0,0,20">
                                    <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,0,0,10">
                                        <TextBlock Text="{Binding ExeVersion}"/>
                                        <TextBlock Text="{Binding Path=Build_Date, Source={StaticResource Resources}}" FontWeight="UltraLight" Margin="10,0,0,0"/>
                                        <TextBlock Text="{Binding ExeDate, StringFormat='dd MMM yyyy HH:mm:ss'}" FontWeight="UltraLight" Margin="5,0,0,0"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding Path=Copyright, Source={StaticResource Resources}}" HorizontalAlignment="Right"/>
                                        <TextBlock Text="{Binding CopyrightDetails}"/>
                                    </StackPanel>
                                </StackPanel>
                                
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="CTecControls" FontWeight="DemiBold" Margin="20,0,0,3"/>
                                <TextBlock Grid.Row="2" Grid.Column="2" Text="{Binding ControlsVersion}" FontWeight="DemiBold" Margin="0,0,0,3"/>

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="CTecDevices" FontWeight="DemiBold" Margin="20,0,0,3"/>
                                <TextBlock Grid.Row="3" Grid.Column="2" Text="{Binding DevicesVersion}" FontWeight="DemiBold" Margin="0,0,0,3"/>

                                <TextBlock Grid.Row="4" Grid.Column="0" Text="CTecUtil" FontWeight="DemiBold" Margin="20,0,0,3"/>
                                <TextBlock Grid.Row="4" Grid.Column="2" Text="{Binding UtilVersion}" FontWeight="DemiBold" Margin="0,0,0,3"/>

                                <Button Grid.Row="5" Grid.Column="0" Grid.ColumnSpan="3" HorizontalAlignment="Left" Margin="20,20,0,0" Click="History_Click">
                                    <StackPanel Orientation="Horizontal">
                                        <ctc:Icon IconType="History" Width="12" Height="12" Foreground="{StaticResource Brush03}" Margin="0,3,5,3"/>
                                        <TextBlock Text="{Binding Path=Revision_History, Source={StaticResource Resources}}"/>
                                    </StackPanel>
                                </Button>

                                <Image Grid.Row="3" Grid.Column="3" Grid.RowSpan="3" Source="/CTecControls;component/UI/Images/c-tec.png" Height="70" Stretch="Uniform" VerticalAlignment="Top" Margin="20,10,10,0"/>

                            </Grid>
                        </StackPanel>
                    </Border>
                </Popup>
                <!--#endregion-->
                
                <!--#endregion-->

            </Grid>
        </Border>
    </Grid>
</Window>